@using CV_storage.Core.Enums
@model CvItemViewModel

@{
    ViewBag.Title = "Edit";
    Layout = "_Layout";
    string headerPart = $"{Model.FirstName} {Model.LastName}'s";
}

<h2>Edit @headerPart CV</h2>
@using (Html.BeginForm("Edit", "Home", FormMethod.Post))
{
    <div class="col">
        <h3>Cv Main Information</h3>
        @Html.EditorFor(m => m, "CvEdit")

        <div class="border border-dark border-1 mb-3"></div>
        <h3>Address Information</h3>
        @Html.EditorFor(m => m.MainAddress, "AddressEdit")

        <div class="border border-dark border-1 mb-3"></div>
        <h3>Job Experience</h3>
        @Html.EditorFor(m => m.JobExperience, "JobExperienceEdit")
        <button id="add-job-item" type="button" class="btn btn-success mb-3">Add Job Experience</button>

        <div class="border border-dark border-1 mb-3"></div>
        <h3>Gained Skills</h3>
        @Html.EditorFor(m => m.GainedSkill, "GainedSkillEdit")
        <button id="add-skill-item" type="button" class="btn btn-success mb-3">Add Skill</button>

        <div class="border border-dark border-1 mb-3"></div>
        <h3>Educational Information</h3>
        @Html.EditorFor(m => m.Education, "EducationEdit")
        <button id="add-education-item" type="button" class="btn btn-success mb-3">Add Education</button>

        <div class="border border-dark border-1 mb-3"></div>
        <h3>Language Information</h3>
        @Html.EditorFor(m => m.LanguageKnowledge, "LanguageListEdit")
        <button id="add-language-item" type="button" class="btn btn-success mb-3">Add language</button>
    </div>

    <div class="btn-group" role="group">
        <button asp-action="Index" class="btn btn-primary mb-3">Back to List</button>
        <button type="submit" class="btn btn-primary mb-3">Update</button>
    </div>
}

@section Scripts
{
    <script>
        $(document).ready(function(){
            //language
            $("#add-language-item").on("click", function(){
                const itemCount = $('#language-section').find("div.mb-3").length / 2;

                $.get(`/Language/AddLanguageSectionItem?itemCount=${itemCount}`, function (data, status){
                    $('#language-section').append(data);
                })
            })

            $("#language-section").on("click", ".delete-language", function(){
                const id = $(this).attr("id");

                $.post("/Language/DeleteLanguageItem", { "id" : id }, function(data, status){
                    window.location.reload();
                })
            })

            //education
            $("#add-education-item").on("click", function () {
                const itemCount = $('#education-section').find("div.mb-3").length / 8;

                $.get(`/Education/AddEducationSectionItem?itemCount=${itemCount}`, function (data, status) {
                    $('#education-section').append(data);
                })
            })

            $("#education-section").on("click", ".delete-education", function () {
                const id = $(this).attr("id");

                $.post("/Education/DeleteEducationItem", { "id": id }, function (data, status) {
                    window.location.reload();
                })
            })

            //job experience
            $("#add-job-item").on("click", function () {
                const itemCount = $('#job-section').find("div.mb-3").length / 6;

                $.get(`/JobExperience/AddJobExperienceSectionItem?itemCount=${itemCount}`, function (data, status) {
                    $('#job-section').append(data);
                })
            })

            $("#job-section").on("click", ".delete-job", function () {
                const id = $(this).attr("id");

                $.post("/JobExperience/DeleteJobExperienceItem", { "id": id }, function (data, status) {
                    window.location.reload();
                })
            })

            //gained skill
            $("#add-skill-item").on("click", function () {
                const itemCount = $('#skill-section').find("div.mb-3").length / 3;

                $.get(`/GainedSkill/AddGainedSkillSectionItem?itemCount=${itemCount}`, function (data, status) {
                    $('#skill-section').append(data);
                })
            })

            $("#skill-section").on("click", ".delete-skill", function () {
                const id = $(this).attr("id");

                $.post("/GainedSkill/DeleteGainedSkillItem", { "id": id }, function (data, status) {
                    window.location.reload();
                })
            })
        })
    </script>
}